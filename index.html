<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Invaders</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #000;
            color: #fff;
            overflow: hidden;
        }
        .game-container {
            width: 100%;
            height: 100vh;
            background: #000 url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Cg fill-rule="evenodd"%3E%3Cg fill="%231a1a1a" fill-opacity="0.4"%3E%3Cpath opacity=".5" d="M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h16v9h1v-9h9v9h1v-9h9v9h1v-9h9v9h1v-9h9v9h1v-9h9v9h1v-9h9v9h1v-9h9v9h1v-9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-1v9h1zm-10 0v-9h-1v9h1zm-10 0v-9h-1v9h1zm-10 0v-9h-1v9h1zm-10 0v-9h-1v9h1zm-10 0v-9h-1v9h1zm-10 0v-9h-1v9h1zm-10 0v-9h-1v9h1zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9z"/%3E%3Cpath d="M6 5V0h1v5h4v1H6v4H5V6H0V5h5z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            position: relative;
        }

        .word {
            position: absolute;
            color: #00ff00;
            background-color: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.1s ease-out;
            text-shadow: 0 0 5px #00ff00;
            white-space: nowrap;
            will-change: transform;
        }

        .word.typed {
            color: #ffff00;
        }
        
        .word.destroy {
            transition: all 0.3s ease-in;
            transform: scale(1.5);
            opacity: 0;
            color: #ff0000;
            border-color: #ff0000;
            text-shadow: 0 0 10px #ff0000;
        }

        .laser {
            position: absolute;
            width: 3px;
            height: 100px; /* Será ajustado dinámicamente */
            background: linear-gradient(to top, #ff0000, #ffff00, #ffffff);
            transform-origin: bottom center;
            z-index: 5;
            will-change: transform, height;
        }
        
        #spaceship {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            filter: drop-shadow(0 0 10px #00ffff);
            transition: transform 0.2s ease-out;
        }
        
        #spaceship.hit {
            animation: ship-hit 0.5s ease-in-out;
        }

        @keyframes ship-hit {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); filter: drop-shadow(0 0 15px #ff0000); }
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle linear infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        #current-input-container {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 2px solid #00ffff;
            border-radius: 10px;
            font-size: 24px;
            color: #fff;
            letter-spacing: 4px;
            min-width: 300px;
            text-align: center;
        }

        #modal {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 100;
            text-align: center;
        }
        
        .modal-content {
            padding: 40px;
            border: 2px solid #00ffff;
            border-radius: 10px;
            background: rgba(0, 15, 30, 0.9);
            box-shadow: 0 0 20px #00ffff;
        }

        .modal-content button {
            background-color: #00ff00;
            color: #000;
            padding: 15px 30px;
            border: none;
            cursor: pointer;
            font-size: 20px;
            margin-top: 20px;
            border-radius: 5px;
            transition: all 0.2s;
        }
        
        .modal-content button:hover {
            background-color: #fff;
            box-shadow: 0 0 15px #fff;
        }
    </style>
</head>
<body class="bg-black text-white select-none">

    <div id="game-container" class="relative w-full h-screen">
        <!-- Stars will be generated here -->
    </div>
    
    <!-- UI Elements -->
    <div class="absolute top-5 left-5 text-xl">Puntuación: <span id="score">0</span></div>
    <div class="absolute top-5 right-5 text-xl">Nivel: <span id="level">1</span></div>
    <div class="absolute top-12 right-5 text-xl">Vidas: <span id="lives">3</span></div>

    <!-- Game Screen where words appear -->
    <div id="game-screen" class="absolute inset-0"></div>

    <!-- Player's spaceship -->
    <svg id="spaceship" viewBox="0 0 24 24" fill="#00ffff" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2L2.5 21.5h19L12 2zm0 4.34L17.25 19H6.75L12 6.34z"/>
    </svg>
    
    <!-- Current typing input display -->
    <div id="current-input-container">
        <span id="current-input"></span><span class="animate-ping">_</span>
    </div>

    <!-- Modals for Start/Game Over -->
    <div id="modal">
        <div class="modal-content">
            <h1 id="modal-title" class="text-4xl mb-4 text-cyan-300">TYPING INVADERS</h1>
            <p id="modal-text" class="text-lg mb-4">Destruye las palabras invasoras escribiéndolas.</p>
            <p id="modal-score" class="text-2xl text-yellow-300 hidden"></p>
            <button id="start-button">Iniciar Juego</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script>
        // Game Elements
        const gameContainer = document.getElementById('game-container');
        const gameScreen = document.getElementById('game-screen');
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level');
        const livesEl = document.getElementById('lives');
        const spaceship = document.getElementById('spaceship');
        const currentInputEl = document.getElementById('current-input');
        
        // Modal Elements
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalText = document.getElementById('modal-text');
        const modalScore = document.getElementById('modal-score');
        const startButton = document.getElementById('start-button');
        
        // Game State
        let score = 0;
        let level = 1;
        let lives = 3;
        let wordsOnScreen = [];
        let gameInterval;
        let isPlaying = false;
        let currentInput = "";
        
        // Game Configuration
        const config = {
            wordsPerLevel: 10,
            baseSpeed: 10, // seconds to cross screen
            speedIncrease: 0.5,
            baseSpawnRate: 2000, // ms
            spawnRateDecrease: 100,
        };

        const wordList = [
            "hola", "mundo", "juego", "facil", "nave", "laser", "rojo", "azul",
            "espacio", "planeta", "estrella", "codigo", "rapido", "tecla", "punto",
            "cometa", "galaxia", "orbita", "universo", "cohete", "mision", "logica",
            "velocidad", "precision", "desafio", "meteorito", "agujero", "nebula",
            "constelacion", "programacion", "interfaz", "algoritmo", "variable",
            "funcion", "compilar", "desarrollo", "cuantica", "tecnologia", "innovacion"
        ];
        
        // Sound Engine
        const synth = new Tone.Synth().toDestination();
        const laserSound = () => {
            synth.triggerAttackRelease("C5", "8n", Tone.now());
            synth.triggerAttackRelease("G4", "8n", Tone.now() + 0.1);
        };
        const explosionSound = () => {
            const noiseSynth = new Tone.NoiseSynth({
                noise: { type: "white" },
                envelope: { attack: 0.005, decay: 0.1, sustain: 0 }
            }).toDestination();
            noiseSynth.triggerAttackRelease("8n");
        };
        const gameOverSound = () => {
            synth.triggerAttackRelease("C3", "4n", Tone.now());
            synth.triggerAttackRelease("G2", "4n", Tone.now() + 0.2);
            synth.triggerAttackRelease("E2", "2n", Tone.now() + 0.4);
        };
        const levelUpSound = () => {
             synth.triggerAttackRelease("C4", "8n", Tone.now());
             synth.triggerAttackRelease("E4", "8n", Tone.now() + 0.1);
             synth.triggerAttackRelease("G4", "8n", Tone.now() + 0.2);
             synth.triggerAttackRelease("C5", "8n", Tone.now() + 0.3);
        }

        // --- Game Logic ---

        function startGame() {
            isPlaying = true;
            modal.style.display = 'none';
            score = 0;
            level = 1;
            lives = 3;
            currentInput = "";
            updateUI();
            
            // Clear any existing words
            wordsOnScreen.forEach(word => word.element.remove());
            wordsOnScreen = [];
            
            gameInterval = setInterval(spawnWord, config.baseSpawnRate);
            requestAnimationFrame(gameLoop);
        }
        
        function gameOver() {
            isPlaying = false;
            clearInterval(gameInterval);
            gameOverSound();
            
            modalTitle.textContent = "Juego Terminado";
            modalText.textContent = "¡Los invasores han ganado! Inténtalo de nuevo.";
            modalScore.textContent = `Puntuación Final: ${score}`;
            modalScore.classList.remove('hidden');
            startButton.textContent = "Reiniciar";
            modal.style.display = 'flex';
        }

        function gameLoop() {
            if (!isPlaying) return;
            
            const screenHeight = gameScreen.offsetHeight;
            
            wordsOnScreen.forEach((word, index) => {
                const wordRect = word.element.getBoundingClientRect();
                if (wordRect.top > screenHeight) {
                    word.element.remove();
                    wordsOnScreen.splice(index, 1);
                    loseLife();
                }
            });
            
            requestAnimationFrame(gameLoop);
        }

        function loseLife() {
            if (!isPlaying) return;
            lives--;
            spaceship.classList.add('hit');
            setTimeout(() => spaceship.classList.remove('hit'), 500);
            explosionSound();
            updateUI();
            if (lives <= 0) {
                gameOver();
            }
        }
        
        function spawnWord() {
            const text = wordList[Math.floor(Math.random() * wordList.length)];
            const wordElement = document.createElement('div');
            wordElement.className = 'word';
            wordElement.textContent = text;
            
            const screenWidth = gameScreen.offsetWidth;
            const wordWidth = text.length * 18; // Estimate word width
            
            wordElement.style.left = `${Math.random() * (screenWidth - wordWidth)}px`;
            wordElement.style.top = '-50px';
            
            const speed = config.baseSpeed - (level * config.speedIncrease);
            wordElement.style.transition = `transform ${Math.max(speed, 2)}s linear`;
            
            gameScreen.appendChild(wordElement);

            // Trigger the animation
            requestAnimationFrame(() => {
                 wordElement.style.transform = `translateY(${gameScreen.offsetHeight + 100}px)`;
            });
            
            const wordObj = {
                text: text,
                element: wordElement,
                typed: ''
            };
            wordsOnScreen.push(wordObj);
        }

        function handleKeyPress(e) {
            if (!isPlaying) return;

            // Allow backspace to clear input
            if (e.key === 'Backspace') {
                currentInput = currentInput.slice(0, -1);
                updateCurrentInputDisplay();
                updateWordHighlights();
                return;
            }

            // Ignore non-alphanumeric keys (except space if needed)
            if (e.key.length > 1 || !e.key.match(/[a-z0-9]/i)) {
                return;
            }

            currentInput += e.key;
            
            let wordDestroyed = false;
            for (let i = 0; i < wordsOnScreen.length; i++) {
                if (wordsOnScreen[i].text === currentInput) {
                    destroyWord(wordsOnScreen[i]);
                    wordsOnScreen.splice(i, 1);
                    wordDestroyed = true;
                    break;
                }
            }

            if (wordDestroyed) {
                currentInput = "";
            }
            
            updateCurrentInputDisplay();
            updateWordHighlights();
        }

        function updateWordHighlights() {
            wordsOnScreen.forEach(wordObj => {
                if (wordObj.text.startsWith(currentInput) && currentInput.length > 0) {
                    wordObj.element.classList.add('typed');
                    // Create a highlighted part
                    const highlightedText = `<span class="text-yellow-300">${currentInput}</span>` + wordObj.text.substring(currentInput.length);
                    wordObj.element.innerHTML = highlightedText;
                } else {
                    wordObj.element.classList.remove('typed');
                    wordObj.element.innerHTML = wordObj.text; // Reset innerHTML
                }
            });
        }
        
        function destroyWord(wordObj) {
            score++;
            laserSound();
            fireLaser(wordObj.element);
            
            wordObj.element.classList.add('destroy');
            explosionSound();

            setTimeout(() => {
                wordObj.element.remove();
            }, 300);
            
            if (score > 0 && score % config.wordsPerLevel === 0) {
                levelUp();
            }
            
            updateUI();
        }

        function levelUp() {
            level++;
            levelUpSound();
            clearInterval(gameInterval);
            const newSpawnRate = config.baseSpawnRate - (level * config.spawnRateDecrease);
            gameInterval = setInterval(spawnWord, Math.max(newSpawnRate, 500));
        }

        function fireLaser(targetElement) {
            const laser = document.createElement('div');
            laser.className = 'laser';
            
            const spaceshipRect = spaceship.getBoundingClientRect();
            const targetRect = targetElement.getBoundingClientRect();
            
            const startX = spaceshipRect.left + spaceshipRect.width / 2;
            const startY = spaceshipRect.top;
            const endX = targetRect.left + targetRect.width / 2;
            const endY = targetRect.top + targetRect.height / 2;

            const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI + 90;
            const distance = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));

            laser.style.left = `${startX}px`;
            laser.style.top = `${startY}px`;
            laser.style.height = `${distance}px`;
            laser.style.transform = `rotate(${angle}deg)`;
            
            gameContainer.appendChild(laser);
            
            setTimeout(() => {
                laser.remove();
            }, 100);
        }

        function updateUI() {
            scoreEl.textContent = score;
            levelEl.textContent = level;
            livesEl.textContent = '❤️'.repeat(lives);
        }
        
        function updateCurrentInputDisplay() {
            currentInputEl.textContent = currentInput;
        }

        // Background Stars
        function createStars() {
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDuration = `${Math.random() * 2 + 1}s`;
                star.style.animationDelay = `${Math.random() * 2}s`;
                gameContainer.appendChild(star);
            }
        }
        
        // --- Event Listeners ---
        startButton.addEventListener('click', () => {
            // Tone.js requires a user interaction to start the audio context
            Tone.start();
            startGame();
        });
        window.addEventListener('keydown', handleKeyPress);
        
        // Initial setup
        window.onload = () => {
            createStars();
            updateUI();
        };

    </script>
</body>
</html>
